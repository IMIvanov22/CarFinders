<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Car Search</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/searchforcars.css">
</head>
<body>
    <div class="navbar">
        <a class="logo-fixed">
            <img src="/static/images/CarFinders logo.png" alt="CarFinders Logo">
        </a>
        <ul class="nav-menu">
            <li><a href="/">Home</a></li>
            <li><a href="/pages/searchforcars.html">Found Cars</a></li>
            <li><a href="/pages/contactus.html">Contact Us</a></li>
            <li><a href="/pages/aboutus.html">About Us</a></li>
        </ul>
    </div>
    <h1>Search for Cars by Review Keyword</h1>

    <form id="search-form" method="POST">
        <label>Enter keyword (e.g. "quiet", "fast", "cheap"):</label><br>
        <input type="text" name="keyword" required>
        <button type="submit">Search</button>
    </form>

    <div id="results-container"></div>

    <script>
    document.getElementById("search-form").addEventListener("submit", function (e) {
        e.preventDefault();

        const keyword = document.querySelector('input[name="keyword"]').value;

        fetch('/GetCar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `keyword=${encodeURIComponent(keyword)}`
        })
        .then(response => response.json())
        .then(data => {
            const resultsContainer = document.getElementById("results-container");
            resultsContainer.innerHTML = "";

            if (data.result && data.result.length > 0) {
                const heading = document.createElement("h2");
                heading.textContent = `Results for "${data.keyword}"`;
                resultsContainer.appendChild(heading);

                data.result.forEach(car => {
                    const carContainer = document.createElement("div");
                    carContainer.classList.add("car-block");

                    const carName = document.createElement("h3");
                    if (car.link) {
                        const link = document.createElement("a");
                        link.href = car.link;
                        link.target = "_blank";
                        link.textContent = car.name;
                        carName.appendChild(link);
                    } else {
                        carName.textContent = car.name;
                    }
                    carContainer.appendChild(carName);

                    if (car.image) {
                        const img = document.createElement("img");
                        img.src = `/static/images/${car.image}`;
                        img.alt = car.name;
                        img.style.width = "300px";
                        carContainer.appendChild(img);
                    }

                    const ul = document.createElement("ul");
                    car.matched_reviews.forEach(review => {
                        const li = document.createElement("li");
                        li.textContent = review;
                        ul.appendChild(li);
                    });
                    carContainer.appendChild(ul);

                    resultsContainer.appendChild(carContainer);
                });
            } else {
                resultsContainer.innerHTML = `<p>No matching reviews found.</p>`;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById("results-container").innerHTML = `<p>Error loading results.</p>`;
        });
    });
    </script>
</body>
</html>